#include "mundo.h"

Mundo::Mundo():nombres{"aad","aada","aapo","aaron","abby","abdul","abel","abigail","acácio","adelindo","ademir","adira","adolfo","adrian","adriana","adrião","afet","agnès","aguinaldo","agustin","aisha","aitor","alba","albert","alberte","alberto","alcibíades","alcinda","alcino","aldrovanda","alejandra","alejandro","aleksandra","aletéia","alex","alexander","alexandra","alexandre","alfonso","alfredo","alicia","aliciane","aline","alisa","alkan","allan","allen","allie","alma","almerindo","almurtão","aloís","altamira","alvaro","alvin","alyssa","amador","amalie","amanda","amber","amelia","amparo","amy","amélie","ana","andrea","andreas","andres","andresa","andy","angel","angela","angeles","angie","angèle","anna","annabelle","anne","anne-kathrin","anni","annie","anton","antonia","antonio","antónio","april","aquila","arnaud","arnold","arnoldo","arquimínio","arsénio","arthur","arturo","ary","astrid","asuncion","aubree","augusta","aurora","austin","auta","ava","avery","axel","axelle","azélio","baguandas","barac","barbara","beatrice","beatriz","becky","begoña","belen","bella","ben","benita","benito","benjamin","bently","bernard","bete","beth","betina","betino","bill","billy","birgitta","blake","blanca","blanche","boanerges","boaventura","bob","bobbie","bobby","bonnie","borja","brad","brandie","brandon","brandy","brayden","brennan","breno","brent","brian","bridget","britney","brittany","brooklyn","bruce","bryan","byron","caitlin","calvin","cameron","candice","cariana","carl","carla","carlos","carmelo","carmen","carol","carole","carolina","caroline","carolyn","carter","cassandra","cassiana","cassiano","catalina","caterina","catherine","cathy","cedrico","celia","celso","cesaltino","cesar","ceyhan","chad","charbel","charles","charlotte","cherly","chester","chloe","chris","christian","christine","christy","cidalino","claire","clara","clarice","clarindo","claude","claudia","claudirene","clayton","clifford","clifton","clinton","cloé","clídio","colleen","concepcion","concetta","connor","conny","constâncio","consuelo","corina","corinne","cory","cosme","craig","cristian","cristina","cristobal","célestin","célia","célian","dagmar","dan","dana","daniel","daniela","danny","darrell","darren","darryl","daryl","david","davut","dawn","dean","deann","deborah","debra","demelsa","denazaide","dener","denise","derek","derrick","deusdedito","diana","diane","dianne","diego","dilay","dilce","diocléia","dirk","djalme","dolores","domingo","donna","dora","dorian","dorle","douglas","duane","durbalino","dustin","dwayne","dwight","dylan","dária","déborah","earl","eberhardt","ed","eda","eddie","edelina","edelnide","edgar","edinéia","edna","eduardo","edwin","elaine","eleanor","elena","eleutério","eli","elias","elijah","elisa","elisabetta","elisete","eliza","elizabeth","ella","ellen","ellie","elliot","elma","elsie","elza","eládio","elóides","ema","emaús","emil","emilia","emilie","emilio","emily","emmelin","emmi","emílio","encarnacion","enilda","enrique","erasmo","eric","erika","erin","ernest","ernesto","esmirna","esperanza","esteban","estefânio","estelle","esther","estéfani","estélio","etelvira","ethan","eugene","eugenia","eugenio","eva","evan","evandro","evelyn","evelácio","evelásio","fabian","fabrícia","fatima","faustina","feliciano","felipe","felix","fernando","ferrer","fijgje","filinto","filipo","filomena","flenn","fletcher","florence","florinda","fradique","frances","francisca","francisco","franklin","fred","frederick","freya","frida","gabe","gabin","gabriel","gabriela","gabriella","galiano","gamaliel","gavin","gema","geneci","genesis","george","gerald","geraldine","gerardo","gerberto","german","gert","gertrudes","ghizlane","giani","gilbert","gilda","girão","gisele","glen","gloria","gláucia","gonzalo","gonçala","gordon","grace","graciela","greg","gregorio","gregory","guilherme","guilhermina","guillermo","guimar","gustavo","gwendolyn","gül","hala","hanna","harold","harvey","hazel","heather","hector","hedda","heidi","heiko","heinz","helena","helier","hemelyn","henry","herbert","hilde","hildegard","hildegart","holly","honório","howard","hugh","hugo","hunter","hélmut","hérman","iag","ibérico","ida","idálio","ignacio","iker","ilda","ilona","ilza","imre","ines","ingrid","inmaculada","iracema","irene","irina","irídea","isaac","isabel","isabelle","isaiah","isla","ismael","isolino","ivan","ivanete","ivonete","izabella","jaci","jacinto","jacira","jack","jacob","jaime","jake","jakob","jamie","jamila","jane","janet","jaqueline","jar","jared","jason","javier","jay","jayden","jean","jean-luc","jeanne","jeffery","jeffrey","jenny","jerome","jesse","jessica","jessie","jesus","jezabel","jill","jim","jimmy","jo","joan","joann","joaquin","job","jocelaine","joel","john","jon","jonas","jonathan","jonatã","joona","jordi","jorge","joris","josane","jose","josefa","josefina","josep","josilene","josselino","jovina","joy","juan","juana","judd","judy","juho","julcenira","julia","julian","juliano","julie","julio","julius","juni","juninho","juno","justin","júlia","júnior","kailash","kaitlin","karen","karl","karolina","kasper","kathryn","kathy","katie","kaya","kayla","keith","kelen","kenneth","kenney","kim","kimberly","kirk","klaus-d.","kristen","kristina","kurt","kyle","kübra","laica","laila","lana","lance","landon","laura","lauren","lauriete","laurindo","lauro","lawrence","leah","lena","lenira","lenni","lenícia","leo","leon","leonard","leonor","lesa","leslie","lester","leta","levi","lia","liberal","licínio","lidia","lila","liliam","liliano","lillian","lily","linda","lindsay","lino","lisa","lois","lolita","lonnie","lorena","lorenzo","lotta","louanne","louis","louise","lourdes","lucas","lucas or luke","lucia","luciane","luciara","lucille","lucrécia","lucy","ludwig","luis","luisa","luke","luukas","luz","lyam","lázaro","léonie","línton","mabel","macit","maddison","madison","magdalena","magnólia","manuel","manuela","mar","marc","marco","marcos","marcus","margarido","margarita","margaux","margie","mari","maria","mariane","mariano","marice","maricelda","maridelza","marie","mariette","marilise","marilyn","marin","marina","marinalva","mario","marionice","marissol","maritza","marjorie","mark","marli","marluce","marshall","marta","martin","martinho","matt","matthew","mattie","maurice","max","maxime","maxwell","maëline","melike","melinda","melissa","melvin","meral","mercedes","mia","michael","michele","michelle","miguel","miguela","mike","milagros","mildred","milja","milla","mirco","mireille","miriam","miro","misty","mohamed","molly","monica","montserrat","morris","muhammed","mya","myrtle","márcia","márvio","naiara","nanna","naomi","nara","narsélio","natalia","nathaniel","natércio","naïma","neil","nelia","nella","nelson","nerea","nete","nicholas","nick","nicodemos","nicolas","nicolau","nicoline","nicásio","nieves","nihal","ninja","noe","noelia","noelle","nooa","norberta","norma","norman","nuria","nêuton","odélia","olga","olindo","olivar","olive","olivia","orósio","oscar","osnilda","otniel","otto","owen","pablo","paige","paloma","pamela","patricia","patrick","paul","paula","pauline","paulino","pedro","perry","peter","phil","philippe","phillip","phoebe","pihla","pilar","pinja","plínio","pompeu","potira","prisca","procópio","purificacion","quaresma","rachel","rafael","rafaele","raffaele","raisa","ralph","ramon","randy","raquel","raul","ray","raymond","rebecca","reginald","remedios","remígio","rene","renee","reno","ricardo","rich","riley","rita","ritthy","riu","robert","roberta","roberto","robin","rocio","rodrigo","roger","roland","romain","romana","romarilda","romão","ronald","rosa","rosalyn","rosario","rose","rosemerie","rosimara","ross","rotraud","roy","ruben","ruby","russell","rúpio","saionara","sally","salustiano","salustiniano","salvador","samanta","same","samuel","sandor","sandra","sanne","santiago","sara","sarah","savannah","scott","sean","sebastian","selma","serenity","sergio","shane","sharlene","shawn","sherry","shirlei","si","siddártha","silene","siloé","silvano","silvia","silviana","silviara","simauro","simon","sinara","sixto","sofia","soham","solano","soledad","sonia","soraia","stella","stephanie","stephen","sulene","sumeyra","susan","susana","susanna","susie","suzanna","suzanne","suzy","sérgio","sílvia","tabita","tammy","taylor","ted","teka","telma","teodomiro","teresa","terrance","terrence","terri","terry","theo","theodore","theresa","ticiana","ticira","tierri","tim","timmothy","timothy","titouan","todd","tom","tomas","tomothy","tonje","tony","tracey","tracy","travis","trinidad","tristan","troy","tude","tálio","túlia","ubiara","ubirani","universina","valdemar","valdemira","valentin","valério","vando","vanesa","vanessa","vasco","vergílio","vernon","veronica","vicenta","vicente","vicentina","vicki","vickie","victor","victoria","vidaúl","viggo","viktor","vincent","vincenzo","virginia","virgulino","vivan","viveque","viviane","vânio","vílmar","waldinélia","walfried","wallace","walter","wanderleya","warren","weronika","william","willie","wyatt","xander","xavier","xenócrates","xênia","yasemin","yolanda","yvonne","zachary","zarco ","zardilaque","zeli","zenóbia","zoe","zoey","ápio","ângelo","élio","érico"},paises{"afganistán","albania","alemania","andorra","angola","antigua y barbuda","arabia saudita","argelia","argentina","armenia","australia","austria","azerbaiyán","bahamas","bangladés","barbados","baréin","bélgica","belice","benín","bielorrusia","birmania","bolivia","bosnia y herzegovina","botsuana","brasil","brunéi","bulgaria","burkina faso","burundi","bután","cabo verde","camboya","camerún","canadá","catar","chad","chile","china","chipre","ciudad del vaticano","colombia","comoras","corea del norte","corea del sur","costa de marfil","costa rica","croacia","cuba","dinamarca","dominica","ecuador","egipto","el salvador","emiratos árabes unidos","eritrea","eslovaquia","eslovenia","españa","estados unidos","estonia","etiopía","filipinas","finlandia","fiyi","francia","gabón","gambia","georgia","ghana","granada","grecia","guatemala","guyana","guinea","guinea ecuatorial","guinea-bisáu","haití","honduras","hungría","india","indonesia","irak","irán","irlanda","islandia","islas marshall","islas salomón","israel","italia","jamaica","japón","jordania","kazajistán","kenia","kirguistán","kiribati","kuwait","laos","lesoto"},tiposPecados{"Luguria","Gula","Avaricia","Pereza","Ira","Envidia","Soberbia"}
{

}

void Mundo::insertarNuevaPersona(){
	int id=getRandomInt(0,1000000);
	while(arbol.existe(id))
		id=getRandomInt(0,1000000);
	Persona*nuevaPersona=new Persona(nombres[getRandomInt(0,1000)],apellidos[getRandomInt(0,1000)]
			,paises[getRandomInt(0,100)],creencias[getRandomInt(0,10)],profesiones[getRandomInt(0,50)]
			,"xllestebanllx@gmail.com",id);
	familiasPorPais[QString::fromStdString(nuevaPersona->pais)]
			[QString::fromStdString(nuevaPersona->apellido)].insert(nuevaPersona);
	lista.insertar(nuevaPersona);
	if (arbol.cantNodos<lista.size()*0.01)
		arbol.completarArbol(&lista);
	char cantHijos=static_cast<char>(getRandomInt(0,9));
	for(Persona*p:personasSinPapa){
		if (cantHijos==0) break;
		if (p->pais==nuevaPersona->pais){
			nuevaPersona->hijos.append(p);
			personasSinPapa.removeOne(p);
			cantHijos--;
		}
	}
	personasSinPapa.append(nuevaPersona);
}

void Mundo::insertarPersonas(int c){
	for(int i=0;i<c;i++)
		insertarNuevaPersona();
}

Persona*Mundo::eliminar(Persona*p){
	NodoArbol*temp=arbol.raiz;
	while((*temp).hijoDerecho!=nullptr)
		temp=(p->id<(*temp).valor?(*temp).hijoIzquierdo:(*temp).hijoDerecho);
	NodoLista*temp2=(*temp).nodoLista;
	while (temp2->persona->id<p->id)
		temp2=temp2->siguiente;
	if (temp2->persona->id==p->id)
		lista.eliminar(temp2);
	if ((*temp).valor==p->id)
		arbol.corrimientoALaIzquierda(temp);
	if (arbol.cantNodos/2>=lista.size()*0.01)
		arbol.completarArbol(&lista);
	return temp2->persona;
}

void Mundo::pecar(){
	for (NodoLista*temp=lista.primero();temp!=nullptr;temp=temp->siguiente)
		temp->persona->pecar();
}

QMap<QString, int*> Mundo::cantAccionesPorFamilia(bool pecados, QString pais){
	QMap<QString,int*>accionesPorFamilia;
	for(auto j:familiasPorPais.value(pais).keys())
		sumaDeArrays(accionesPorFamilia[j],(pecados?
																					familiasPorPais.value(pais).value(j).sumaPecados():
																					familiasPorPais.value(pais).value(j).sumaVirtudes())
								 );
	return accionesPorFamilia;
}

QMap<QString, int*> Mundo::cantAccionesPorPais(bool pecados){
	QMap<QString,int*>accionesPorPais;
	for(auto i:familiasPorPais.keys())
		for (auto j:cantAccionesPorFamilia(pecados,i))
			sumaDeArrays(accionesPorPais[i],j);
	return accionesPorPais;
}

QVector<QPair<int*, QString> > Mundo::ordenar(QMap<QString, int*> cantidadAccionesPorPais, bool ascendente){
	QVector<QPair<int*,QString>> mapVector;
	for (auto i :cantidadAccionesPorPais.keys())
		mapVector.append(QPair<int*,QString>(cantidadAccionesPorPais[i],i));
	sort(mapVector.begin(),mapVector.end(),comparador(ascendente));
	return mapVector;
}

void Mundo::reporte(bool ascendente, bool pecadores, int cant){
	QVector<QPair<int*,QString>> resultado=ordenar(cantAccionesPorPais(pecadores),ascendente);
	imprimirResultado(resultado,cant);
}

void Mundo::imprimirResultado(QVector<QPair<int*, QString> > resultado, int cant){
	QString salida="";
	for (int i = 0; i < cant&&i<resultado.size(); ++i)
		salida+=QString::number(i)+") "+resultado[i].second+" con "+QString::number(resultado[i].first[8])+"\n";
	cout<<salida.toStdString();
}

void Mundo::reportePaisesMasPecadores(){
	reporte(false,true,10);
}

void Mundo::reportePaisesMenosPecadores(){
	reporte(true,true,5);
}

void Mundo::obrarBien(){
	for (NodoLista*temp=lista.primero();temp!=nullptr;temp=temp->siguiente)
		temp->persona->obrarBien();
}

void Mundo::reportePaisesMasBuenaGente(){
	reporte(false,false,10);
}

void Mundo::reportePaisesMenosBuenaGente(){
	reporte(true,false,5);
}

comparador::comparador(bool a):ascendente(a){}

bool comparador::operator()(const QPair<int*, QString>&a, const QPair<int*, QString>&b) const {
	return ascendente==(a.first[8] < b.first[8]);
}
